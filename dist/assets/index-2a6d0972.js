(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(r){if(r.ep)return;r.ep=!0;const i=t(r);fetch(r.href,i)}})();const c={endMessage:document.getElementById("end-message"),restartButton:document.getElementById("restart-button"),title:document.getElementById("title-container"),livesContainer:document.getElementById("lives-container")};class L{constructor(e){let t=e.trim().split(`
`).map(s=>[...s]);this.height=t.length,this.width=t[0].length,this.startActors=[],this.rows=t.map((s,r)=>s.map((i,n)=>{let a=I[i];return typeof a=="string"?a:(this.startActors.push(a.create(new l(n,r),i)),"empty")}))}}class h{constructor(e,t,s){this.level=e,this.actors=t,this.status=s}static start(e){return new h(e,e.startActors,"playing")}get player(){return this.actors.find(e=>e.type==="player")}}class l{constructor(e,t){this.x=e,this.y=t}plus(e){return new l(this.x+e.x,this.y+e.y)}times(e){return new l(this.x*e,this.y*e)}}class m{constructor(e,t){this.pos=e,this.speed=t}get type(){return"player"}static create(e){return new m(e.plus(new l(0,-.5)),new l(0,0))}}m.prototype.size=new l(.8,1.5);class u{constructor(e,t,s){this.pos=e,this.speed=t,this.reset=s}get type(){return"lava"}static create(e,t){if(t==="=")return new u(e,new l(2,0));if(t==="|")return new u(e,new l(0,2));if(t==="v")return new u(e,new l(0,3),e)}}u.prototype.size=new l(1,1);class f{constructor(e,t,s){this.pos=e,this.basePos=t,this.wobble=s}get type(){return"coin"}static create(e){let t=e.plus(new l(.2,.1));return new f(t,t,Math.random()*Math.PI*2)}}f.prototype.size=new l(.6,.6);L.prototype.touches=function(o,e,t){let s=Math.floor(o.x),r=Math.ceil(o.x+e.x),i=Math.floor(o.y),n=Math.ceil(o.y+e.y);for(let a=i;a<n;a++)for(let d=s;d<r;d++)if((d<0||d>=this.width||a<0||a>=this.height?"wall":this.rows[a][d])===t)return!0;return!1};h.prototype.update=function(o,e){let t=this.actors.map(i=>i.update(o,this,e)),s=new h(this.level,t,this.status);if(s.status!="playing")return s;let r=s.player;if(this.level.touches(r.pos,r.size,"lava"))return new h(this.level,t,"lost");for(let i of t)i!=r&&E(i,r)&&(s=i.collide(s));return s};function E(o,e){return o.pos.x+o.size.x>e.pos.x&&o.pos.x<e.pos.x+e.size.x&&o.pos.y+o.size.y>e.pos.y&&o.pos.y<e.pos.y+e.size.y}u.prototype.collide=function(o){return new h(o.level,o.actors,"lost")};f.prototype.collide=function(o){let e=o.actors.filter(s=>s!=this),t=o.status;return e.some(s=>s.type==="coin")||(t="won"),new h(o.level,e,t)};u.prototype.update=function(o,e){let t=this.pos.plus(this.speed.times(o));return e.level.touches(t,this.size,"wall")?this.reset?new u(this.reset,this.speed,this.reset):new u(this.pos,this.speed.times(-1)):new u(t,this.speed,this.reset)};const P=8,C=.07;f.prototype.update=function(o){let e=this.wobble+o*P,t=Math.sin(e)*C;return new f(this.basePos.plus(new l(0,t)),this.basePos,e)};const b=7,S=30,O=17;m.prototype.update=function(o,e,t){let s=0;(t.ArrowLeft||t.a)&&(s-=b),(t.ArrowRight||t.d)&&(s+=b);let r=this.pos,i=r.plus(new l(s*o,0));e.level.touches(i,this.size,"wall")||(r=i);let n=this.speed.y+o*S,a=r.plus(new l(0,n*o));return e.level.touches(a,this.size,"wall")?(t.ArrowUp||t.w)&&n>0?n=-O:n=0:r=a,new m(r,new l(s,n))};const I={".":"empty","#":"wall","+":"lava","@":m,o:f,"=":u,"|":u,v:u};function B(o){for(var e={},t=(o[0]==="?"?o.substr(1):o).split("&"),s=0;s<t.length;s++){var r=t[s].split("=");e[decodeURIComponent(r[0])]=decodeURIComponent(r[1]||"")}return e}function $(o){let e=Object.create(null);function t(s){o.includes(s.key)&&(e[s.key]=s.type=="keydown",s.preventDefault())}return window.addEventListener("keydown",t),window.addEventListener("keyup",t),e}const D=$(["ArrowLeft","ArrowRight","ArrowUp","w","a","s","d"]);class v{constructor(e,t){this.dom=w("div",{class:"game"},G(t)),this.actorLayer=null,e.appendChild(this.dom)}clear(){this.dom.remove()}}v.prototype.syncState=function(o){this.actorLayer&&this.actorLayer.remove(),this.actorLayer=N(o.actors),this.dom.appendChild(this.actorLayer),this.dom.className=`game ${o.status}`,this.scrollPlayerIntoView(o)};v.prototype.scrollPlayerIntoView=function(o){let e=this.dom.clientWidth,t=this.dom.clientHeight,s=e/3,r=this.dom.scrollLeft,i=r+e,n=this.dom.scrollTop,a=n+t,d=o.player,p=d.pos.plus(d.size.times(.5)).times(y);p.x<r+s?this.dom.scrollLeft=p.x-s:p.x>i-s&&(this.dom.scrollLeft=p.x+s-e),p.y<n+s?this.dom.scrollTop=p.y-s:p.y>a-s&&(this.dom.scrollTop=p.y+s-t)};function w(o,e,...t){let s=document.createElement(o);for(let r of Object.keys(e))s.setAttribute(r,e[r]);for(let r of t)s.appendChild(r);return s}const y=20;function G(o){return w("table",{class:"background",style:`width: ${o.width*y}px`},...o.rows.map(e=>w("tr",{style:`height: ${y}px`},...e.map(t=>w("td",{class:t})))))}function N(o){return w("div",{},...o.map(e=>{let t=w("div",{class:`actor ${e.type}`});return t.style.width=`${e.size.x*y}px`,t.style.height=`${e.size.y*y}px`,t.style.left=`${e.pos.x*y}px`,t.style.top=`${e.pos.y*y}px`,t}))}const A=[`                                                    
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
................................................................................
..................................................................###...........
...................................................##......##....##+##..........
....................................o.o......##..................#+++#..........
.................................................................##+##..........
...................................#####..........................#v#...........
............................................................................##..
..##......................................o.o................................#..
..#.....................o....................................................#..
..#......................................#####.............................o.#..
..#..........####.......o....................................................#..
..#..@.......#..#................................................#####.......#..
..############..###############...####################.....#######...#########..
..............................#...#..................#.....#....................
..............................#+++#..................#+++++#....................
..............................#+++#..................#+++++#....................
..............................#####..................#######....................
................................................................................
................................................................................
`,`                                                                     
................................................................................
................................................................................
....###############################.............................................
...##.............................##########################################....
...#.......................................................................##...
...#....o...................................................................#...
...#................................................=.......................#...
...#.o........################...................o..o...........|........o..#...
...#.........................#..............................................#...
...#....o....................##########.....###################....##########...
...#..................................#+++++#.................#....#............
...###############....oo......=o.o.o..#######.###############.#....#............
.....#...............o..o.............#.......#......#........#....#............
.....#....................#############..######.####.#.########....########.....
.....#.............########..............#...........#.#..................#.....
.....#..........####......####...#####################.#..................#.....
.....#........###............###.......................########....########.....
.....#.......##................#########################......#....#............
.....#.......#................................................#....#............
.....###......................................................#....#............
.......#...............o...........................................#............
.......#...............................................o...........#............
.......#########......###.....############.........................##...........
.............#..................#........#####....#######.o.........########....
.............#++++++++++++++++++#............#....#.....#..................#....
.............#++++++++++++++++++#..........###....###...####.o.............#....
.............####################..........#........#......#.....|.........#....
...........................................#++++++++#......####............#....
...........................................#++++++++#.........#........@...#....
...........................................#++++++++#.........##############....
...........................................##########...........................
................................................................................
`,`
......................................#++#........................#######....................................#+#..
......................................#++#.....................####.....####.................................#+#..
......................................#++##########...........##...........##................................#+#..
......................................##++++++++++##.........##.............##...............................#+#..
.......................................##########++#.........#....................................o...o...o..#+#..
................................................##+#.........#.....o...o....................................##+#..
.................................................#+#.........#................................###############++#..
.................................................#v#.........#.....#...#........................++++++++++++++##..
.............................................................##..|...|...|..##............#####################...
..............................................................##+++++++++++##............v........................
...............................................................####+++++####......................................
...............................................#.....#............#######........###.........###..................
...............................................#.....#...........................#.#.........#.#..................
...............................................#.....#.............................#.........#....................
...............................................#.....#.............................##........#....................
...............................................##....#.............................#.........#....................
...............................................#.....#......o..o.....#...#.........#.........#....................
...............#######........###...###........#.....#...............#...#.........#.........#....................
..............##.....##.........#...#..........#.....#.....######....#...#...#########.......#....................
.............##.......##........#.o.#..........#....##...............#...#...#...............#....................
.....@.......#.........#........#...#..........#.....#...............#...#...#...............#....................
....###......#.........#........#...#..........#.....#...............#...#####...######......#....................
....#.#......#.........#.......##.o.##.........#.....#...............#.....o.....#.#.........#....................
++++#.#++++++#.........#++++++##.....##++++++++##....#++++++++++.....#.....=.....#.#.........#....................
++++#.#++++++#.........#+++++##.......##########.....#+++++++##+.....#############.##..o.o..##....................
++++#.#++++++#.........#+++++#....o.................##++++++##.+....................##.....##.....................
++++#.#++++++#.........#+++++#.....................##++++++##..+.....................#######......................
++++#.#++++++#.........#+++++##.......##############++++++##...+..................................................
++++#.#++++++#.........#++++++#########++++++++++++++++++##....+..................................................
++++#.#++++++#.........#++++++++++++++++++++++++++++++++##.....+..................................................
`,`
..............................................................................................................
..............................................................................................................
..............................................................................................................
..............................................................................................................
..............................................................................................................
........................................o.....................................................................
..............................................................................................................
........................................#.....................................................................
........................................#.....................................................................
........................................#.....................................................................
........................................#.....................................................................
.......................................###....................................................................
.......................................#.#.................+++........+++..###................................
.......................................#.#.................+#+........+#+.....................................
.....................................###.###................#..........#......................................
......................................#...#.................#...oooo...#.......###............................
......................................#...#.................#..........#......#+++#...........................
......................................#...#.................############.......###............................
.....................................##...##......#...#......#................................................
......................................#...#########...########..............#.#...............................
......................................#...#...........#....................#+++#..............................
......................................#...#...........#.....................###...............................
.....................................##...##..........#.......................................................
......................................#...#=.=.=.=....#............###........................................
......................................#...#...........#...........#+++#.......................................
......................................#...#....=.=.=.=#.....o......###.......###..............................
.....................................##...##..........#.....................#+++#.............................
..............................o...o...#...#...........#.....#................##v........###...................
......................................#...#...........#..............#.................#+++#..................
.............................###.###.###.###.....o.o..#++++++++++++++#...................v#...................
.............................#.###.#.#.###.#..........#++++++++++++++#........................................
.............................#.............#...#######################........................................
.............................##...........##.........................................###......................
..###.........................#.....#.....#.........................................#+++#................###..
..#.#.........................#....###....#..........................................###.................#.#..
..#...........................#....###....#######........................#####.............................#..
..#...........................#...........#..............................#...#.............................#..
..#...........................##..........#..............................#.#.#.............................#..
..#.......................................#.......|####|....|####|.....###.###.............................#..
..#................###.............o.o....#..............................#.........###.....................#..
..#...............#####.......##..........#.............................###.......#+++#..........#.........#..
..#...............o###o.......#....###....#.............................#.#........###..........###........#..
..#................###........#############..#.oo.#....#.oo.#....#.oo..##.##....................###........#..
..#......@..........#.........#...........#++#....#++++#....#++++#....##...##....................#.........#..
..#############################...........#############################.....################################..
..............................................................................................................
..............................................................................................................
`,`
..................................................................................................###.#.......
......................................................................................................#.......
..................................................................................................#####.......
..................................................................................................#...........
..................................................................................................#.###.......
..........................o.......................................................................#.#.#.......
.............................................................................................o.o.o###.#.......
...................###................................................................................#.......
.......+..o..+................................................#####.#####.#####.#####.#####.#####.#####.......
.......#.....#................................................#...#.#...#.#...#.#...#.#...#.#...#.#...........
.......#=.o..#............#...................................###.#.###.#.###.#.###.#.###.#.###.#.#####.......
.......#.....#..................................................#.#...#.#...#.#...#.#...#.#...#.#.....#.......
.......+..o..+............o..................................####.#####.#####.#####.#####.#####.#######.......
..............................................................................................................
..........o..............###..............................##..................................................
..............................................................................................................
..............................................................................................................
......................................................##......................................................
...................###.........###............................................................................
..............................................................................................................
..........................o.....................................................#......#......................
..........................................................##.....##...........................................
.............###.........###.........###.................................#..................#.................
..............................................................................................................
.................................................................||...........................................
..###########.................................................................................................
..#.........#.o.#########.o.#########.o.##................................................#...................
..#.........#...#.......#...#.......#...#.................||..................#.....#.........................
..#..@......#####...o...#####...o...#####.....................................................................
..#######.....................................#####.......##.....##.....###...................................
........#=..................=................=#...#.....................###...................................
........#######################################...#+++++++++++++++++++++###+++++++++++++++++++++++++++++++++++
..................................................############################################################
..............................................................................................................
`];function R(o){let e=null;function t(s){if(e!=null){let r=Math.min(s-e,100)/1e3;if(o(r)===!1)return}e=s,requestAnimationFrame(t)}requestAnimationFrame(t)}function T(o,e){let t=new e(document.body,o),s=h.start(o),r=1;return new Promise(i=>{R(n=>(s=s.update(n,D),t.syncState(s),s.status==="playing"?!0:r>0?(r-=n,!0):(t.clear(),i(s.status),!1)))})}let x,g;function M(){x=B(window.location.search),g=Number(x.lives)||3,c.endMessage.style.display="none",c.restartButton.style.display="none",c.title.style.display="block"}async function z(o,e){M();const t=()=>{c.livesContainer.textContent=`Lives: ${g}`};t();for(let s=0;s<o.length&&g>0;){let r=await T(new L(o[s]),e);r==="lost"&&(g--,t()),r==="won"&&s++}c.endMessage.style.display="block",c.restartButton.style.display="block",c.title.style.display="none",g===0?c.endMessage.textContent="Sorry, you lost all your lives!":c.endMessage.textContent="Congratulations! You won!",c.restartButton.focus()}function U(){M(),z(A,v)}z(A,v);c.restartButton.addEventListener("click",U);
